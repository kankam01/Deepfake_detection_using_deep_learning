{% extends 'base.html' %}
{% load static %}
{% block content %}

<style>
    /* Loading screen styles with centered content and enhanced background */
    .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        overflow: hidden;
    }
    .loading-screen::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, rgba(0, 0, 0, 0.3) 100%);
        animation: subtle-pulse 8s ease-in-out infinite;
        z-index: -1;
    }
    @keyframes subtle-pulse {
        0%, 100% { opacity: 0.3; }
        50% { opacity: 0.5; }
    }
    .loader-container {
        text-align: center;
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100%;
    }
    .loader {
        width: 80px;
        height: 80px;
        border: 6px solid transparent;
        border-top: 6px solid #00d4ff;
        border-right: 6px solid #00d4ff;
        border-radius: 50%;
        animation: spin 1.2s ease-in-out infinite, pulse 2s infinite;
        position: relative;
        margin-bottom: 20px;
    }
    .loader::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 20px;
        height: 20px;
        background: #00d4ff;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        animation: pulse-dot 1.5s ease-in-out infinite;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    @keyframes pulse {
        0%, 100% { box-shadow: 0 0 20px rgba(0, 212, 255, 0.5); }
        50% { box-shadow: 0 0 40px rgba(0, 212, 255, 0.8); }
    }
    @keyframes pulse-dot {
        0%, 100% { transform: translate(-50%, -50%) scale(1); }
        50% { transform: translate(-50%, -50%) scale(1.3); }
    }
    .progress-bar {
        width: 200px;
        height: 8px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 5px;
        margin: 20px auto;
        overflow: hidden;
    }
    .progress-bar-inner {
        width: 0;
        height: 100%;
        background: #00d4ff;
        border-radius: 5px;
        animation: progress 4s ease-in-out infinite;
    }
    @keyframes progress {
        0% { width: 0; }
        50% { width: 100%; }
        100% { width: 0; }
    }
    .loading-text {
        color: #fff;
        font-size: 28px;
        font-family: 'Arial', sans-serif;
        font-weight: bold;
        letter-spacing: 2px;
        text-transform: uppercase;
        display: flex;
        justify-content: center;
        gap: 5px;
        margin-bottom: 20px;
    }
    .loading-text span {
        display: inline-block;
        animation: wave 1.8s infinite;
    }
    .loading-text span:nth-child(1) { animation-delay: 0s; }
    .loading-text span:nth-child(2) { animation-delay: 0.1s; }
    .loading-text span:nth-child(3) { animation-delay: 0.2s; }
    .loading-text span:nth-child(4) { animation-delay: 0.3s; }
    .loading-text span:nth-child(5) { animation-delay: 0.4s; }
    .loading-text span:nth-child(6) { animation-delay: 0.5s; }
    .loading-text span:nth-child(7) { animation-delay: 0.6s; }
    .loading-text span:nth-child(8) { animation-delay: 0.7s; }
    .loading-text span:nth-child(9) { animation-delay: 0.8s; }
    @keyframes wave {
        0%, 100% { transform: translateY(0); opacity: 1; }
        50% { transform: translateY(-15px); opacity: 0.7; }
    }
    .deepfake-tips {
        width: 300px;
        color: #fff;
        font-size: 16px;
        font-family: 'Arial', sans-serif;
        text-align: center;
        margin: 20px auto;
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
    }
    .deepfake-tips.active {
        opacity: 1;
    }
    .deepfake-tips p {
        margin: 0;
        padding: 10px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 5px;
        line-height: 1.5;
    }
    .wait-message {
        color: #fff;
        font-size: 14px;
        font-family: 'Arial', sans-serif;
        text-align: center;
        margin-top: 10px;
        opacity: 0.8;
    }
    @media (max-width: 576px) {
        .card {
            padding: 20px;
            margin: 10px;
        }
        h1 {
            font-size: 1.5rem;
        }
        .deepfake-tips {
            width: 90%;
            font-size: 14px;
        }
        .loading-text {
            font-size: 24px;
        }
        .loader {
            width: 60px;
            height: 60px;
        }
        .progress-bar {
            width: 180px;
        }
    }

    /* Existing styles from your template */
    body {
        margin: 0;
        height: 100vh;
        overflow-x: hidden;
    }
    .bg {
        background-image: url('{% static "images/newbackground.jpg" %}');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
    }
    .card {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        max-width: 500px;
        width: 100%;
        margin: 20px;
    }
    .logo img {
        max-width: 150px;
        margin-bottom: 20px;
    }
    h1 {
        font-size: 2rem;
        color: #333;
        margin-bottom: 20px;
        text-align: center;
    }
    .form-group {
        margin-bottom: 20px;
    }
    .form-group label {
        font-weight: bold;
        color: #333;
        display: block;
        margin-bottom: 8px;
    }
    .form-control {
        border-radius: 5px;
        padding: 10px;
        font-size: 1rem;
    }
    #slider {
        margin: 10px 0;
        background: #e0e0e0;
        border: none;
    }
    #slider .ui-slider-handle {
        background: #28a745;
        border: none;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        cursor: pointer;
    }
    #slider-value {
        font-weight: bold;
        color: #28a745;
    }
    .btn-success {
        background-color: #28a745;
        border: none;
        padding: 12px;
        font-size: 1.1rem;
        border-radius: 5px;
        width: 100%;
        transition: background-color 0.3s;
    }
    .btn-success:hover {
        background-color: #218838;
    }
    .btn-clear {
        background-color: #dc3545;
        border: none;
        padding: 12px;
        font-size: 1.1rem;
        border-radius: 5px;
        width: 100%;
        transition: background-color 0.3s;
        margin-top: 10px;
        color: #e0e0e0;
    }
    .btn-clear:hover {
        background-color: #c82333;
        color: #e0e0e0;
    }
    .alert-danger {
        font-size: 0.9rem;
        padding: 10px;
        margin-top: 10px;
        border-radius: 5px;
    }
    #videos {
        display: none;
        width: 100%;
        border-radius: 5px;
        margin-bottom: 20px;
    }
</style>

<div class="loading-screen mx-auto" id="loadingScreen">
    <div class="loader-container">
        <div class="loader"></div>
        <div class="progress-bar">
            <div class="progress-bar-inner"></div>
        </div>
        <div class="loading-text">
            <span>A</span><span>n</span><span>a</span><span>l</span><span>y</span><span>z</span><span>i</span><span>n</span><span>g</span>
        </div>
        <div class="deepfake-tips" id="deepfakeTips">
            <p id="tipText"></p>
        </div>
        <div class="wait-message">
            Analyzing your video may take some few minutes, please wait...
        </div>
    </div>
</div>

<div class="bg">
    <div class="container">
        <div class="row align-items-center justify-content-center">
            <div class="col-12 my-auto">
                <!-- <div class="logo text-center mb-3"><img src="{% static 'images/logo1.png' %}" alt="Logo"></div> -->
                <div class="width-400 card mx-auto">
                    <h1>Deepfake Detection System</h1>
                    <video width="100%" controls id="videos">
                        <source src="" id="video_source">
                        Your browser does not support HTML5 video.
                    </video>
                    <form class="form" method="POST" enctype="multipart/form-data" name="video-upload" id="video-upload"
                        class="text-center mt-3">
                        {% csrf_token %}
                        <div class="form-group">
                            <label>{{ form.upload_video_file.label }}</label>
                            {{ form.upload_video_file }}
                            {% if form.upload_video_file.errors %}
                            {% for each_error in form.upload_video_file.errors %}
                            <div class="alert alert-danger mt-1 {{ form.upload_video_file.id_for_label }}">
                                {{ each_error }}
                            </div>
                            {% endfor %}
                            {% endif %}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.sequence_length.id_for_label }}">{{ form.sequence_length.label }}: </label>
                            <span id="slider-value"></span>
                            <input type="number" hidden="hidden" id="{{ form.sequence_length.id_for_label }}"
                                name="{{ form.sequence_length.name }}"></input>
                            <div id="slider"></div>
                            {% if form.sequence_length.errors %}
                            {% for each_error in form.sequence_length.errors %}
                            <div class="alert alert-danger mt-1 {{ form.sequence_length.id_for_label }}">
                                {{ each_error }}
                            </div>
                            {% endfor %}
                            {% endif %}
                        </div>
                        <button id="videoUpload" type="submit" name="submit" class="btn btn-success mt-3 btn-block">Upload Your Video</button>
                        <button type="button" id="clearVideo" class="btn btn-clear mt-3 btn-block">Clear Video</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
{% block js_cripts %}
<script src="{% static 'js/script.js' %}"></script>
<script>
    $(function () {
        var sliderSequenceNumbers = [10, 20, 40, 60, 80, 100];
        var slider = $("div#slider").slider({
            value: 1,
            min: 0,
            max: sliderSequenceNumbers.length - 1,
            slide: function (event, ui) {
                $('#{{ form.sequence_length.id_for_label }}').val(sliderSequenceNumbers[ui.value]);
                $('#slider-value').html(sliderSequenceNumbers[ui.value]);
            }
        });
        $("#{{ form.sequence_length.id_for_label }}").val(sliderSequenceNumbers[$("#slider").slider("value")]);
        $('#slider-value').html(sliderSequenceNumbers[$("#slider").slider("value")]);

        // Deepfake tips array
        const deepfakeTips = [
            "Deepfakes often show unnatural facial movements or inconsistent lighting.",
            "Look for irregularities in lip-sync or unnatural voice patterns.",
            "Deepfakes may have subtle glitches around the eyes or mouth.",
            "Check for inconsistent backgrounds or unusual head movements.",
            "Advanced deepfakes use AI to mimic voices, so verify audio authenticity.",
            "Our system analyzes frame-by-frame to detect deepfake artifacts.",
            "Deepfakes can be used in scamsâ€”always verify the source of videos."
        ];

        // Function to cycle through tips
        function cycleTips() {
            let currentTip = 0;
            const $tipText = $('#tipText');
            const $tipsContainer = $('#deepfakeTips');

            function showNextTip() {
                $tipsContainer.removeClass('active');
                setTimeout(() => {
                    $tipText.text(deepfakeTips[currentTip]);
                    $tipsContainer.addClass('active');
                    currentTip = (currentTip + 1) % deepfakeTips.length;
                    setTimeout(showNextTip, 4000); // Change tip every 4 seconds
                }, 500); // Delay for fade-out effect
            }

            showNextTip();
        }

        // Show loading screen and start tips on form submit
        $('#video-upload').on('submit', function() {
            $('#loadingScreen').fadeIn();
            cycleTips();
        });

        // Clear video input and hide video preview
        $('#clearVideo').on('click', function() {
            $('#{{ form.upload_video_file.id_for_label }}').val(''); // Clear the file input
            $('#videos').hide(); // Hide the video preview
            $('#video_source').attr('src', ''); // Clear the video source
            $('#videos')[0].load(); // Reload video element to clear source
            $('#{{ form.upload_video_file.id_for_label }}').show(); // Ensure the input field remains visible
        });

        // Show video preview when a file is selected
        $('#{{ form.upload_video_file.id_for_label }}').on('change', function() {
            const file = this.files[0];
            if (file) {
                const videoURL = URL.createObjectURL(file);
                $('#video_source').attr('src', videoURL);
                $('#videos').show();
                $('#videos')[0].load();
            }
        });
    });
</script>
{% endblock %}